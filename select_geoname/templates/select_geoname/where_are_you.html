{% extends "select_geoname/__base.html" %}
{% load staticfiles %}
{% block title %}Search{% endblock title %}

{% block stylesheets %}

<link rel="stylesheet" href="{% static 'css/bootstrap-multiselect.css' %}"></link>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css" type="text/css">
{% endblock stylesheets %}

{% block content %}

<div class="container">
    <h1 style="text-align:center;" class="towards_bottom" >Where Are You</h1>
    <form action="" method="GET" id="submit_form">
    <div class="row towards_bottom">
        <div class="col-md-1">
        </div>
            <div class="col-md-3">
                <div class="dropdown">
                    <select id="id_country" class="form-control" name="countries" onchange="load_states();">
                      <option value="">Select Country</option>
                      {% for country in countries %}
                      <option value="{{country.id}}">{{country.name}}</option>
                      {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="dropdown">
                    <select class="form-control" id="id_states" name="states" onchange="load_cities();" >
                        <option value="">Select State</option>
                        <option value="">Plz Select Country</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="dropdown">
                    <select class="form-control" id="id_cities" name="cities">
                      <option value="">Select City</option>
                      <option value="">Plz Select State</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <input onclick="submit_form()" class="btn btn-success" value="Submit">
            </div>
        </div>

        <div class="towards_bottom">
            <h4 id="id_data"></h4>
        </div>
    </form>
</div>

{% endblock content %}


{% block js %}

<script>

function load_states(){
    country_id = $("#id_country").val();
    if(country_id != null ){
        data = {
            "action":"for_states",
            "country_id":country_id,
        }
        $.ajax({
            url: "{% url 'where_are_you' %}",
            type: "GET",
            data: data,
            success: function(response) {
                $("#id_states").html(response.data);
                // var city = getParamValue('city');
                // if (city){
                //    $("select[name='city']").val(city);
               }
        })
    }
}

</script>

<script>

function load_cities(){
    country_id = $("#id_country").val();
    if(country_id != "" ){
        state_id = $("#id_states").val();
        data = {
            "action":"for_cities",
            "state_id":state_id,
        }
        $.ajax({
            url: "{% url 'where_are_you' %}",
            type: "GET",
            data: data,
            success: function(response) {
                $("#id_cities").html(response.data);
                // var city = getParamValue('city');
                // if (city){
                //    $("select[name='city']").val(city);
               }
        })
    }

}

</script>

<script>

function submit_form(){
    country = $("#id_country").val();
    state = $("#id_states").val();
    city = $("#id_cities").val();
    var formdata = $("#submit_form").serialize();
    alert(formdata);
    if(country != "" & state !="" & city!=""){
        data = {
            "action":"form_submit",
            "form_data":formdata,
            "country":country,
            "state":state,
            "city":city
        }
        $.ajax({
            url: "{% url 'where_are_you' %}",
            type: "GET",
            data: data,
            success: function(data){
                    $("#id_data").html("So your Country is <strong>"+ data.country_name +"</strong>, state is <strong>"+
                                        data.state_name + "</strong>, and city is <strong>" + data.city_name + "</strong>"  )
            },
        })

    }
}

</script>


<script type="text/javascript" src="{% static 'javascript/validate.min.js' %}"></script>

{% endblock js %}
